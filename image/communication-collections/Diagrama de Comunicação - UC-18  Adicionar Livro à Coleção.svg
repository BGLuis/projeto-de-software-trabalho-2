<?xml version="1.0" encoding="us-ascii" standalone="no"?><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentStyleType="text/css" height="502px" preserveAspectRatio="none" style="width:4873px;height:502px;background:#FFFFFF;" version="1.1" viewBox="0 0 4873 502" width="4873px" zoomAndPan="magnify"><defs/><g><text fill="#000000" font-family="sans-serif" font-size="14" font-weight="bold" lengthAdjust="spacing" textLength="420" x="2219.75" y="24.9659">Diagrama de Comunica&#231;&#227;o - UC-18: Adicionar Livro &#224; Cole&#231;&#227;o</text><g id="elem_Client"><rect fill="#F1F1F1" height="58.1358" style="stroke:#181818;stroke-width:0.5;" width="65" x="321.5" y="47.0679"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="51" x="328.5" y="64.0339">:Cliente</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="30" x="339" y="83.1018">Web</text><line style="stroke:#181818;stroke-width:0.5;" x1="322.5" x2="385.5" y1="89.2038" y2="89.2038"/></g><g id="elem_Controller"><rect fill="#F1F1F1" height="39.0679" style="stroke:#181818;stroke-width:0.5;" width="197" x="368.5" y="338.4679"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="183" x="375.5" y="355.4339">:CollectionsBooksController</text><line style="stroke:#181818;stroke-width:0.5;" x1="369.5" x2="564.5" y1="361.5358" y2="361.5358"/></g><g id="elem_Service"><rect fill="#F1F1F1" height="39.0679" style="stroke:#181818;stroke-width:0.5;" width="178" x="913" y="338.4679"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="164" x="920" y="355.4339">:CollectionsBooksService</text><line style="stroke:#181818;stroke-width:0.5;" x1="914" x2="1090" y1="361.5358" y2="361.5358"/></g><g id="elem_CollectionRepo"><rect fill="#F1F1F1" height="39.0679" style="stroke:#181818;stroke-width:0.5;" width="155" x="1773.5" y="338.4679"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="141" x="1780.5" y="355.4339">:CollectionRepository</text><line style="stroke:#181818;stroke-width:0.5;" x1="1774.5" x2="1927.5" y1="361.5358" y2="361.5358"/></g><g id="elem_BookRepo"><rect fill="#F1F1F1" height="39.0679" style="stroke:#181818;stroke-width:0.5;" width="121" x="4292.5" y="338.4679"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="107" x="4299.5" y="355.4339">:BookRepository</text><line style="stroke:#181818;stroke-width:0.5;" x1="4293.5" x2="4412.5" y1="361.5358" y2="361.5358"/></g><g id="elem_CollectionBookRepo"><rect fill="#F1F1F1" height="39.0679" style="stroke:#181818;stroke-width:0.5;" width="187" x="3267.5" y="338.4679"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="173" x="3274.5" y="355.4339">:CollectionBookRepository</text><line style="stroke:#181818;stroke-width:0.5;" x1="3268.5" x2="3453.5" y1="361.5358" y2="361.5358"/></g><g id="elem_Guard"><rect fill="#F1F1F1" height="39.0679" style="stroke:#181818;stroke-width:0.5;" width="85" x="565.5" y="56.6079"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="71" x="572.5" y="73.5739">:JWTGuard</text><line style="stroke:#181818;stroke-width:0.5;" x1="566.5" x2="649.5" y1="79.6758" y2="79.6758"/></g><g id="elem_Cache"><rect fill="#F1F1F1" height="39.0679" style="stroke:#181818;stroke-width:0.5;" width="96" x="1382" y="338.4679"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="82" x="1389" y="355.4339">:RedisCache</text><line style="stroke:#181818;stroke-width:0.5;" x1="1383" x2="1477" y1="361.5358" y2="361.5358"/></g><g id="elem_DBMaster"><rect fill="#F1F1F1" height="58.1358" style="stroke:#181818;stroke-width:0.5;" width="111" x="4756.5" y="328.9379"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="67" x="4778.5" y="345.9039">:Database</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="97" x="4763.5" y="364.9718">MySQL Master</text><line style="stroke:#181818;stroke-width:0.5;" x1="4757.5" x2="4866.5" y1="371.0738" y2="371.0738"/></g><g id="elem_DBSlave"><rect fill="#F1F1F1" height="58.1358" style="stroke:#181818;stroke-width:0.5;" width="99" x="2348.5" y="328.9379"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="67" x="2364.5" y="345.9039">:Database</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="85" x="2355.5" y="364.9718">MySQL Slave</text><line style="stroke:#181818;stroke-width:0.5;" x1="2349.5" x2="2446.5" y1="371.0738" y2="371.0738"/></g><g id="elem_GMN34"><path d="M4463,344.1479 L4463,371.8539 L4707,371.8539 L4707,354.1479 L4697,344.1479 L4463,344.1479 " fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><path d="M4697,344.1479 L4697,354.1479 L4707,354.1479 L4697,344.1479 " fill="#FEFFDD" style="stroke:#181818;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="223" x="4469" y="363.0449">Invalida cache de cole&#231;&#245;es do usu&#225;rio</text></g><g id="elem_GMN40"><path d="M6,220.2079 L6,495.7982 L320,495.7982 L320,230.2079 L310,220.2079 L6,220.2079 " fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><path d="M310,220.2079 L310,230.2079 L320,230.2079 L310,220.2079 " fill="#FEFFDD" style="stroke:#181818;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="243" x="12" y="239.1049">Fluxo UC-18: Adicionar Livro &#224; Cole&#231;&#227;o</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="213" x="12" y="256.8109">1. Cliente envia bookId para cole&#231;&#227;o</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="208" x="12" y="274.517">2. JWT valida identidade do usu&#225;rio</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="242" x="12" y="292.223">3. Verifica ownership da cole&#231;&#227;o (user_id)</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="213" x="12" y="309.929">4. Valida que livro existe e est&#225; ativo</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="234" x="12" y="327.635">5. Verifica se livro j&#225; n&#227;o est&#225; na cole&#231;&#227;o</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="174" x="12" y="345.341">6. Cria rela&#231;&#227;o many-to-many</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="169" x="12" y="363.047">7. Invalida cache de cole&#231;&#245;es</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="138" x="12" y="380.7531">8. Retorna confirma&#231;&#227;o</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="3" x="12" y="398.4591">&#160;</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="126" x="12" y="416.1651">Regras de Neg&#243;cio:</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="269" x="12" y="433.8711">- Usu&#225;rio s&#243; pode adicionar em suas cole&#231;&#245;es</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="293" x="12" y="451.5771">- Livro n&#227;o pode ser duplicado na mesma cole&#231;&#227;o</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="217" x="12" y="469.2831">- Livro deve estar ativo (n&#227;o deleted)</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="232" x="12" y="486.9892">- Rela&#231;&#227;o registra timestamp (addedAt)</text></g><!--link Client to Controller--><g id="link_Client_Controller"><path codeLine="18" d="M384.77,105.4379 C392.97,114.2979 401.15,124.5579 407,135.2079 C444.81,204.0979 459.2158,292.3542 464.1858,332.1142 " fill="none" id="Client-to-Controller" style="stroke:#181818;stroke-width:1.0;"/><polygon fill="#181818" points="464.93,338.0679,467.7828,328.6413,464.3098,333.1065,459.8446,329.6336,464.93,338.0679" style="stroke:#181818;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="11" x="430.97" y="150.1049">1:</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="222" x="444.97" y="150.1049">POST /collections/:collectionId/books</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="53" x="522.47" y="167.8109">{bookId}</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="165" x="466.47" y="185.517">Authorization: Bearer token</text></g><!--link Controller to Client--><g id="link_Controller_Client"><path codeLine="51" d="M455.12,337.9979 C435.6,308.3579 393.88,251.2779 344,220.2079 C302.44,194.3179 267.53,229.2579 238,190.2079 C223.26,170.7079 225.15,156.0079 238,135.2079 C255.99,106.0879 287.7153,92.634 315.2353,85.244 " fill="none" id="Controller-to-Client" style="stroke:#181818;stroke-width:1.0;"/><polygon fill="#181818" points="321.03,83.6879,311.3006,82.1589,316.2011,84.9846,313.3753,89.8852,321.03,83.6879" style="stroke:#181818;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="11" x="239" y="168.1049">2:</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="141" x="253" y="168.1049">200 OK {message, data}</text></g><!--link Guard to Client--><g id="link_Guard_Client"><path codeLine="20" d="M565.37,76.1379 C515.09,76.1379 438.58,76.1379 392.95,76.1379 " fill="none" id="Guard-to-Client" style="stroke:#181818;stroke-width:1.0;"/><polygon fill="#181818" points="386.95,76.1379,395.95,80.1379,391.95,76.1379,395.95,72.1379,386.95,76.1379" style="stroke:#181818;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="33" x="412" y="69.0349">1.0.1:</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="92" x="448" y="69.0349">validateToken()</text></g><!--link Client to Guard--><g id="link_Client_Guard"><path codeLine="21" d="M386.69,85.9879 C404,90.6879 425.71,95.7979 445.5,98.1379 C472.42,101.3279 479.54,101.0279 506.5,98.1379 C526.04,96.0479 541.5002,93.1252 559.5202,88.8752 " fill="none" id="Client-to-Guard" style="stroke:#181818;stroke-width:1.0;"/><polygon fill="#181818" points="565.36,87.4979,555.6821,85.6707,560.4935,88.6457,557.5185,93.4571,565.36,87.4979" style="stroke:#181818;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="33" x="446.5" y="94.0349">1.0.2:</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="23" x="482.5" y="94.0349">JWT</text></g><!--link Guard to Controller--><g id="link_Guard_Controller"><path codeLine="22" d="M642.97,95.9279 C657.23,105.6079 672.17,118.8379 680,135.2079 C690.55,157.2579 690.7,168.2279 680,190.2079 C644.73,262.6279 566.503,310.2178 515.153,335.4978 " fill="none" id="Guard-to-Controller" style="stroke:#181818;stroke-width:1.0;"/><polygon fill="#181818" points="509.77,338.1479,519.6113,337.7614,514.2559,335.9395,516.0778,330.5841,509.77,338.1479" style="stroke:#181818;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="33" x="688.97" y="168.1049">1.0.3:</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="54" x="724.97" y="168.1049">user={id}</text></g><!--link Controller to Service--><g id="link_Controller_Service"><path codeLine="24" d="M565.84,374.8679 C581.81,377.0079 598.21,378.8479 613.75,379.9979 C669.37,384.1479 809.15,384.4279 864.75,379.9979 C880.27,378.7679 890.7431,377.6258 906.6131,375.3058 " fill="none" id="Controller-to-Service" style="stroke:#181818;stroke-width:1.0;"/><polygon fill="#181818" points="912.55,374.4379,903.0661,371.7818,907.6026,375.1612,904.2233,379.6977,912.55,374.4379" style="stroke:#181818;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="22" x="614.75" y="375.8949">1.1:</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="224" x="639.75" y="375.8949">addBook(userId, collectionId, bookId)</text></g><!--link Service to Controller--><g id="link_Service_Controller"><path codeLine="50" d="M912.72,357.9979 C816.89,357.9979 671.08,357.9979 571.75,357.9979 " fill="none" id="Service-to-Controller" style="stroke:#181818;stroke-width:1.0;"/><polygon fill="#181818" points="565.75,357.9979,574.75,361.9979,570.75,357.9979,574.75,353.9979,565.75,357.9979" style="stroke:#181818;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="22" x="590.75" y="350.8949">1.2:</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="272" x="615.75" y="350.8949">{message: "Livro adicionado", collectionBook}</text></g><!--link Service to CollectionRepo--><g id="link_Service_CollectionRepo"><path codeLine="26" d="M1005.44,337.9779 C1013.1,300.2879 1035.51,219.5379 1091,185.7579 C1179.83,131.6679 1221.48,175.7779 1325,185.7579 C1404.77,193.4479 1425.07,197.7379 1502,220.2079 C1615.34,253.3079 1737.6662,306.1287 1802.6362,335.6087 " fill="none" id="Service-to-CollectionRepo" style="stroke:#181818;stroke-width:1.0;"/><polygon fill="#181818" points="1808.1,338.0879,1801.557,330.7265,1803.5468,336.0219,1798.2514,338.0117,1808.1,338.0879" style="stroke:#181818;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="33" x="1092" y="168.1049">1.1.1:</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="196" x="1128" y="168.1049">findOne({id: collectionId, userId})</text></g><!--link CollectionRepo to Service--><g id="link_CollectionRepo_Service"><path codeLine="29" d="M1808.1,338.0879 C1743.13,308.6079 1615.34,253.3079 1502,220.2079 C1425.07,197.7379 1404.77,193.4479 1325,185.7579 C1221.48,175.7779 1179.83,131.6679 1091,185.7579 C1035.51,219.5379 1014.295,294.4081 1006.635,332.0981 " fill="none" id="CollectionRepo-to-Service" style="stroke:#181818;stroke-width:1.0;"/><polygon fill="#181818" points="1005.44,337.9779,1011.1524,329.9549,1006.4358,333.0781,1003.3126,328.3616,1005.44,337.9779" style="stroke:#181818;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="33" x="1101" y="168.1049">1.1.2:</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="178" x="1137" y="168.1049">collection (ownership verified)</text></g><!--link CollectionRepo to DBSlave--><g id="link_CollectionRepo_DBSlave"><path codeLine="27" d="M1928.79,357.9979 C2042.94,357.9979 2246.6,357.9979 2342.17,357.9979 " fill="none" id="CollectionRepo-to-DBSlave" style="stroke:#181818;stroke-width:1.0;"/><polygon fill="#181818" points="2348.17,357.9979,2339.17,353.9979,2343.17,357.9979,2339.17,361.9979,2348.17,357.9979" style="stroke:#181818;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="44" x="1954" y="350.8949">1.1.1.1:</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="322" x="2001" y="350.8949">SELECT * FROM collections WHERE id=? AND user_id=?</text></g><!--link DBSlave to CollectionRepo--><g id="link_DBSlave_CollectionRepo"><path codeLine="28" d="M2348.28,365.2579 C2309.49,370.5379 2254.2,377.2279 2205.5,379.9979 C2146.04,383.3879 2130.98,382.9579 2071.5,379.9979 C2024.05,377.6379 1977.0222,373.1101 1934.8922,368.3601 " fill="none" id="DBSlave-to-CollectionRepo" style="stroke:#181818;stroke-width:1.0;"/><polygon fill="#181818" points="1928.93,367.6879,1937.4252,372.6711,1933.8985,368.2481,1938.3215,364.7214,1928.93,367.6879" style="stroke:#181818;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="44" x="2072.5" y="375.8949">1.1.1.2:</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="85" x="2119.5" y="375.8949">collectionData</text></g><!--link Service to BookRepo--><g id="link_Service_BookRepo"><path codeLine="31" d="M1040.15,337.9779 C1103.88,305.7479 1236.97,243.6179 1358,220.2079 C1942.33,107.1679 3440.85,189.5879 4036,185.7579 C4149.78,185.0279 4199.08,120.0879 4292,185.7579 C4341.87,220.9979 4350.9763,294.6433 4352.5563,331.9733 " fill="none" id="Service-to-BookRepo" style="stroke:#181818;stroke-width:1.0;"/><polygon fill="#181818" points="4352.81,337.9679,4356.4258,328.8068,4352.5986,332.9724,4348.433,329.1451,4352.81,337.9679" style="stroke:#181818;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="33" x="4037" y="168.1049">1.1.3:</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="218" x="4073" y="168.1049">findOne({id: bookId, deletedAt: null})</text></g><!--link BookRepo to Service--><g id="link_BookRepo_Service"><path codeLine="34" d="M4352.81,337.9679 C4351.23,300.6379 4341.87,220.9979 4292,185.7579 C4199.08,120.0879 4149.78,185.0279 4036,185.7579 C3440.85,189.5879 1942.33,107.1679 1358,220.2079 C1236.97,243.6179 1109.2342,303.0401 1045.5042,335.2701 " fill="none" id="BookRepo-to-Service" style="stroke:#181818;stroke-width:1.0;"/><polygon fill="#181818" points="1040.15,337.9779,1049.9866,337.4857,1044.6119,335.7214,1046.3762,330.3467,1040.15,337.9779" style="stroke:#181818;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="33" x="4076" y="168.1049">1.1.4:</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="140" x="4112" y="168.1049">book (exists and active)</text></g><!--link BookRepo to DBSlave--><g id="link_BookRepo_DBSlave"><path codeLine="32" d="M4292.13,345.8379 C4150.29,318.0679 3786.5,250.0779 3479,220.2079 C2726.33,147.0879 2461.24,175.8079 2448,185.7579 C2403.8,218.9479 2396.8766,282.9179 2396.7666,322.7079 " fill="none" id="BookRepo-to-DBSlave" style="stroke:#181818;stroke-width:1.0;"/><polygon fill="#181818" points="2396.75,328.7079,2400.7749,319.719,2396.7638,323.7079,2392.7749,319.6969,2396.75,328.7079" style="stroke:#181818;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="44" x="2301.5" y="168.1049">1.1.3.1:</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="354" x="2348.5" y="168.1049">SELECT * FROM books WHERE id=? AND deleted_at IS NULL</text></g><!--link DBSlave to BookRepo--><g id="link_DBSlave_BookRepo"><path codeLine="33" d="M2396.75,328.7079 C2396.86,288.9179 2403.8,218.9479 2448,185.7579 C2461.24,175.8079 2726.33,147.0879 3479,220.2079 C3786.5,250.0779 4144.4018,316.9151 4286.2418,344.6851 " fill="none" id="DBSlave-to-BookRepo" style="stroke:#181818;stroke-width:1.0;"/><polygon fill="#181818" points="4292.13,345.8379,4284.0662,340.1832,4287.2232,344.8772,4282.5291,348.0342,4292.13,345.8379" style="stroke:#181818;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="44" x="2449" y="168.1049">1.1.3.2:</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="59" x="2496" y="168.1049">bookData</text></g><!--link Service to CollectionBookRepo--><g id="link_Service_CollectionBookRepo"><path codeLine="36" d="M1028.66,338.1379 C1082.31,299.5779 1208.54,215.7079 1330,185.7579 C1425.8,162.1379 1453.35,183.9079 1552,185.7579 C1961.1,193.4179 2064.69,181.1479 2472,220.2079 C2763.7,248.1779 3099.4545,308.053 3261.1545,338.633 " fill="none" id="Service-to-CollectionBookRepo" style="stroke:#181818;stroke-width:1.0;"/><polygon fill="#181818" points="3267.05,339.7479,3258.95,334.1452,3262.1371,338.8188,3257.4635,342.0059,3267.05,339.7479" style="stroke:#181818;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="33" x="1331" y="168.1049">1.1.5:</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="184" x="1367" y="168.1049">findOne({collectionId, bookId})</text></g><!--link CollectionBookRepo to Service--><g id="link_CollectionBookRepo_Service"><path codeLine="39" d="M3267.05,339.7479 C3105.35,309.1679 2763.7,248.1779 2472,220.2079 C2064.69,181.1479 1961.1,193.4179 1552,185.7579 C1453.35,183.9079 1425.8,162.1379 1330,185.7579 C1208.54,215.7079 1087.1821,296.0762 1033.5321,334.6362 " fill="none" id="CollectionBookRepo-to-Service" style="stroke:#181818;stroke-width:1.0;"/><polygon fill="#181818" points="1028.66,338.1379,1038.3027,336.1334,1032.7201,335.2198,1033.6337,329.6372,1028.66,338.1379" style="stroke:#181818;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="33" x="1383" y="168.1049">1.1.6:</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="80" x="1419" y="168.1049">null (can add)</text></g><!--link Service to CollectionBookRepo--><g id="link_Service_CollectionBookRepo"><path codeLine="41" d="M1028.66,338.1379 C1082.31,299.5779 1208.54,215.7079 1330,185.7579 C1425.8,162.1379 1453.35,183.9079 1552,185.7579 C1961.1,193.4179 2064.69,181.1479 2472,220.2079 C2763.7,248.1779 3099.4545,308.053 3261.1545,338.633 " fill="none" id="Service-to-CollectionBookRepo-1" style="stroke:#181818;stroke-width:1.0;"/><polygon fill="#181818" points="3267.05,339.7479,3258.95,334.1452,3262.1371,338.8188,3257.4635,342.0059,3267.05,339.7479" style="stroke:#181818;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="33" x="1293" y="168.1049">1.1.7:</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="260" x="1329" y="168.1049">save({collectionId, bookId, addedAt: now()})</text></g><!--link CollectionBookRepo to Service--><g id="link_CollectionBookRepo_Service"><path codeLine="44" d="M3267.05,339.7479 C3105.35,309.1679 2763.7,248.1779 2472,220.2079 C2064.69,181.1479 1961.1,193.4179 1552,185.7579 C1453.35,183.9079 1425.8,162.1379 1330,185.7579 C1208.54,215.7079 1087.1821,296.0762 1033.5321,334.6362 " fill="none" id="CollectionBookRepo-to-Service-1" style="stroke:#181818;stroke-width:1.0;"/><polygon fill="#181818" points="1028.66,338.1379,1038.3027,336.1334,1032.7201,335.2198,1033.6337,329.6372,1028.66,338.1379" style="stroke:#181818;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="33" x="1379" y="168.1049">1.1.8:</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="88" x="1415" y="168.1049">collectionBook</text></g><!--link CollectionBookRepo to DBSlave--><g id="link_CollectionBookRepo_DBSlave"><path codeLine="37" d="M3267.38,357.9979 C3066.68,357.9979 2606.84,357.9979 2453.75,357.9979 " fill="none" id="CollectionBookRepo-to-DBSlave" style="stroke:#181818;stroke-width:1.0;"/><polygon fill="#181818" points="2447.75,357.9979,2456.75,361.9979,2452.75,357.9979,2456.75,353.9979,2447.75,357.9979" style="stroke:#181818;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="44" x="2620.5" y="350.8949">1.1.5.1:</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="427" x="2667.5" y="350.8949">SELECT * FROM collection_books WHERE collection_id=? AND book_id=?</text></g><!--link DBSlave to CollectionBookRepo--><g id="link_DBSlave_CollectionBookRepo"><path codeLine="38" d="M2447.76,361.7179 C2521.79,367.0279 2665.3,376.5579 2787.5,379.9979 C2956.57,384.7779 3147.5952,373.9753 3261.1552,365.8653 " fill="none" id="DBSlave-to-CollectionBookRepo" style="stroke:#181818;stroke-width:1.0;"/><polygon fill="#181818" points="3267.14,365.4379,3257.8779,362.0892,3262.1527,365.7941,3258.4478,370.0689,3267.14,365.4379" style="stroke:#181818;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="44" x="2788.5" y="375.8949">1.1.5.2:</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="91" x="2835.5" y="375.8949">null (not exists)</text></g><!--link CollectionBookRepo to DBMaster--><g id="link_CollectionBookRepo_DBMaster"><path codeLine="42" d="M3378.38,338.1579 C3414.83,298.2479 3503.97,209.2779 3601,176.7579 C3773.18,119.0479 4692.33,195.6979 4732,220.2079 C4771.42,244.5579 4791.6551,290.3286 4802.2151,323.0086 " fill="none" id="CollectionBookRepo-to-DBMaster" style="stroke:#181818;stroke-width:1.0;"/><polygon fill="#181818" points="4804.06,328.7179,4805.0989,318.924,4802.5226,323.9601,4797.4865,321.3838,4804.06,328.7179" style="stroke:#181818;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="44" x="3602" y="159.1049">1.1.7.1:</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="381" x="3649" y="159.1049">INSERT INTO collection_books (collection_id, book_id, added_at)</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="122" x="3755" y="176.8109">VALUES (?, ?, NOW())</text></g><!--link DBMaster to CollectionBookRepo--><g id="link_DBMaster_CollectionBookRepo"><path codeLine="43" d="M4804.06,328.7179 C4793.5,296.0379 4771.42,244.5579 4732,220.2079 C4692.33,195.6979 3773.18,119.0479 3601,176.7579 C3503.97,209.2779 3418.8762,293.8176 3382.4262,333.7276 " fill="none" id="DBMaster-to-CollectionBookRepo" style="stroke:#181818;stroke-width:1.0;"/><polygon fill="#181818" points="3378.38,338.1579,3387.4029,334.2099,3381.7519,334.466,3381.4958,328.8149,3378.38,338.1579" style="stroke:#181818;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="44" x="3746" y="168.1049">1.1.7.2:</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="93" x="3793" y="168.1049">relationCreated</text></g><!--link Service to Cache--><g id="link_Service_Cache"><path codeLine="46" d="M1091.46,357.9979 C1179.68,357.9979 1305.21,357.9979 1375.53,357.9979 " fill="none" id="Service-to-Cache" style="stroke:#181818;stroke-width:1.0;"/><polygon fill="#181818" points="1381.53,357.9979,1372.53,353.9979,1376.53,357.9979,1372.53,361.9979,1381.53,357.9979" style="stroke:#181818;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="33" x="1116" y="350.8949">1.1.9:</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="205" x="1152" y="350.8949">del("user:" + userId + ":collections")</text></g><!--link Cache to Service--><g id="link_Cache_Service"><path codeLine="48" d="M1381.62,366.3179 C1349.51,371.3979 1306.37,377.4079 1268,379.9979 C1209.05,383.9879 1148.7934,379.2941 1097.1734,372.8241 " fill="none" id="Cache-to-Service" style="stroke:#181818;stroke-width:1.0;"/><polygon fill="#181818" points="1091.22,372.0779,1099.6527,377.1662,1096.1812,372.6997,1100.6476,369.2283,1091.22,372.0779" style="stroke:#181818;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="40" x="1206" y="375.8949">1.1.10:</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="18" x="1249" y="375.8949">OK</text></g><!--link DBSlave to GMN34--><g id="link_DBSlave_GMN34"><path d="M2447.82,342.7279 C2579.84,303.1479 2950.34,197.8879 3267.5,162.7079 C3520.61,134.6279 4181.5,57.6779 4413.5,162.7079 C4498.8,201.3179 4558.49,305.6479 4578.05,343.7879 " fill="none" id="DBSlave-GMN34" style="stroke:#181818;stroke-width:1.0;stroke-dasharray:7.0,7.0;"/></g><!--link Client to GMN40--><g id="link_Client_GMN40"><path d="M321.09,82.2579 C289.5,88.9279 242.74,103.6879 216,135.2079 C195.77,159.0579 182.97,189.3079 174.96,219.7379 " fill="none" id="Client-GMN40" style="stroke:#181818;stroke-width:1.0;stroke-dasharray:7.0,7.0;"/></g><!--SRC=[ZLRRSk9647tNLtJn4a40tzPhHrNE5WOsOHT30jX-SPLhZCPuTiKCcHdOTLp-bspb8H-mbI_Wnz9p4H8W4rDKQIITFjrzkjKpckc4GekHYIHJ0Z65ffZEEHkJvJ_BlmNKuB9PEpYDe16pCHESIEYoXHIm_0kH2RMe8FW1-dUVg1Og47WTQoX5pOHHhkaDlwPt9I0At8CSG2G9hf1KdGlnMJK5rz8yamw-kdtPP4ZbWesfnVjr4NX0Pq8nBUIZPyw_o0mCvGOqVLJ4MW3VVfaPVhWU_J8dChP0kyhU3MZCL9EC7rmgTfMzRH5DxeX2AIyUXxztuO8exKLgdRkRby73X2oenzgrATRPsTcghgrEizFlDGRGxLmD-kPL4BXIGUtdN1KWWahb8AfKuBV-S0HxuwmMUr5squdtxanfRlYJkNRYvnlUcEi78TcVn00YEAT48fyMdoaF0Yk5TUMSMZVr_RfrjI09Yucc8uCDoxd0d5aAFZHWL3XbAuWSKKS6DLTKdZsn-1dJp21eu1l8ewrx4iUcaA6nwSHLoATP1PTVEGXII-irtrifbsExPppkSngYysY3oZbunWJNxP7HbosZScJ3ThVT7445tW_w5pas1TU_jWTjOF7PEsZqMfRwrjm5ALDjHvnEoOpEjDDMKDjYRPf1ABvmAjK3cy62IdRFw8PGwGUoOZZQaiZfMyMXb51DuuQEWC-J15LQ6HVeSrIaZst9JMKyxotHq1b2xxBRNPDeEqANfU6oicHH50Zo9eL2IByofHKG7WD1THRqfPRPydYyfabHzwsrp2vPZdUtpMrUeTpZbLZc_QussexTgMKg1Y4N6fmCnV4M2FWsinuJRZx5LyjsOamLnbYiMTMG-NuINyBo3WtTTCs8dOYTth0z6E5brD-MC5nJhveAvvrYivLl-5MZUzaUGlYk2lZlzQ_3SZbOUViVOK-Si98cTfus9SK16RzMrjFr3zLWrsKrUyyA_PD1utSIbimOYKhmenzLk2ZbfhugbGEiCGN99W-eQuUxoGrZIuV7Yh4xBFnB5SG2IURBRvA9mBah2lHWt_ZkVyn5LpJLhHPFKweKcT08IkvqGlnf9HQbwaQspsjZVttViMI7-_leTiM9ymS_TjmjR7vtGcin1N6V7cS0VvNA-sJ-LRpcg5IfM8k3khUdGFc24T-PC2EIf5BXkSf03-jcO_Cx8GulDC85AfgNqG2Fwd1bH-sOG3PzunmVX7upA5k3DsZWMF-OKqXihFOZnQ20Ahty1jXX2yT-d6DNAVeJGhWXTcY-6VjRJ5DYTgPNNGHJmXzhMjJCrK9EwZkRnM9Ewp30mwMq_FoUoIdnvqwd_e3YwLKPmnwTBB-Z-97N6O-lNY9Go-ym4uWXg_BGAQWv6cwug_cwsSoi2Qe6yNoMOFAeEeQ1lJ7TJ3OrY-d2oeSEh7mu_GoHtstA7ZjOIIBf13N7kcisDMRJ6OH-G9K3Yfk6QRpWFm00]--></g></svg>